<div class="container p-4 text-center">
  <div class="main-title-modern mb-4">
    <i class="fas fa-calendar-alt ms-2"></i>
    <span>حجوزاتي الطبية</span>
  </div>

  <!-- إحصائيات الحالات -->
  <div class="stats-cards mb-4 d-flex gap-3 justify-content-end">
    <div class="stat-card text-center" [class.active]="selectedStatus === null" (click)="selectStatus(null)" style="cursor:pointer;">
      <i class="fas fa-list fa-lg mb-1"></i>
      <h4 class="mb-0">{{ appointments.length }}</h4>
      <small>الكل</small>
    </div>
    <div class="stat-card text-center" [class.active]="selectedStatus === 'قادمة'" (click)="selectStatus('قادمة')" style="cursor:pointer;">
      <i class="fas fa-calendar-check fa-lg mb-1"></i>
      <h4 class="mb-0">{{ countUpcoming }}</h4>
      <small>مواعيد قادمة</small>
    </div>
    <div class="stat-card text-center" [class.active]="selectedStatus === 'مكتملة'" (click)="selectStatus('مكتملة')" style="cursor:pointer;">
      <i class="fas fa-history fa-lg mb-1"></i>
      <h4 class="mb-0">{{ countCompleted }}</h4>
      <small>مكتملة</small>
    </div>
    <div class="stat-card text-center" [class.active]="selectedStatus === 'ملغاة'" (click)="selectStatus('ملغاة')" style="cursor:pointer;">
      <i class="fas fa-calendar-times fa-lg mb-1"></i>
      <h4 class="mb-0">{{ countCancelled }}</h4>
      <small>ملغاة</small>
    </div>
    <div class="stat-card text-center" [class.active]="selectedStatus === 'مؤجلة'" (click)="selectStatus('مؤجلة')" style="cursor:pointer;">
      <i class="fas fa-user-clock fa-lg mb-1"></i>
      <h4 class="mb-0">{{ countPostponed }}</h4>
      <small>مؤجلة</small>
    </div>
    <div class="stat-card text-center" [class.active]="selectedStatus === 'لم يحضر'" (click)="selectStatus('لم يحضر')" style="cursor:pointer;">
      <i class="fas fa-user-slash fa-lg mb-1"></i>
      <h4 class="mb-0">{{ countNoShow }}</h4>
      <small>لم يحضر</small>
    </div>
  </div>

  <!-- شريط البحث والتصفية -->
  <div class="search-filter-section mb-4 d-flex flex-wrap gap-3 justify-content-end align-items-center">
    <div class="search-box position-relative">
      <i class="fas fa-search position-absolute" style="top: 50%; right: 10px; transform: translateY(-50%);"></i>
      <input type="text" class="form-control ps-5" placeholder="ابحث عن طبيب..." [(ngModel)]="searchTerm">
    </div>
    <div class="filter-buttons d-flex gap-2">
      <button class="filter-btn" [class.active]="selectedFilter === 'الكل'" (click)="selectedFilter = 'الكل'">الكل</button>
      <button class="filter-btn" [class.active]="selectedFilter === 'اليوم'" (click)="selectedFilter = 'اليوم'">اليوم</button>
      <button class="filter-btn" [class.active]="selectedFilter === 'الأسبوع'" (click)="selectedFilter = 'الأسبوع'">هذا الأسبوع</button>
      <button class="filter-btn" [class.active]="selectedFilter === 'الشهر'" (click)="selectedFilter = 'الشهر'">هذا الشهر</button>
    </div>
  </div>

  <!-- عرض الحجوزات -->
  @if (filteredAppointments.length === 0) {
    <p class="empty-message">لا توجد حجوزات مسجلة حالياً</p>
  } @else {
    @for (appointment of filteredAppointments; track appointment.id) {
      <div
        class="card mb-4 shadow-sm rounded-4 px-3 py-3 appointment-card"
        (click)="goToDetails(appointment.id)"
        [ngClass]="{ 'highlight': appointment.id === highlightedId }"
        style="cursor: pointer;"
      >
        <div class="d-flex align-items-center justify-content-between">
          <div class="text-start">
            <h6 class="fw-bold mb-1">{{ appointment.doctorName }}</h6>
            <small class="text-muted">{{ appointment.specialization || '' }}</small>
          </div>
          <img
            [src]="appointment.doctorImage || 'https://cdn-icons-png.flaticon.com/512/387/387561.png'"
            alt="صورة الطبيب"
            class="rounded-circle doctor-img"
            width="50"
            height="50"
          />
        </div>

        <div class="date-box mt-2 text-end">
          <i class="far fa-calendar-alt me-2"></i>
          {{ getFormattedDate(appointment.date) }} -
          {{ getFormattedTime(appointment.startTime) }}
        </div>
      </div>
    }
  }
</div>
